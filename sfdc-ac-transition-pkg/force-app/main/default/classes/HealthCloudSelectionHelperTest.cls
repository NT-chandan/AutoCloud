/*
 * Copyright (c) 2023, Salesforce, Inc.
 * All rights reserved.
 * SPDX-License-Identifier: Apache 2.0 Clause
 * For full license text, see the LICENSE file in the repo root or http://www.apache.org/licenses/
 */
@isTest
private class HealthCloudSelectionHelperTest {

    private static final String EXTERNAL_STRINGS = '{ "size": 22, "totalSize": 15, "done": true, "queryLocator": null, "entityTypeName": "ExternalString", "records": [ { "attributes": { "type": "ExternalString", "url": "/services/data/v50.0/tooling/sobjects/ExternalString/1014x000007AblEAAS" }, "Id": "1014x000007AblEAAS", "Name": "MappingDocTitle", "Value": "Transition Approach", "Language": "en_US" }, { "attributes": { "type": "ExternalString", "url": "/services/data/v50.0/tooling/sobjects/ExternalString/1014x000007AblYAAS" }, "Id": "1014x000007AblYAAS", "Name": "MappingDocExtension", "Value": "Assessment Results", "Language": "en_US" }, { "attributes": { "type": "ExternalString", "url": "/services/data/v50.0/tooling/sobjects/ExternalString/1014x000007AbldAAC" }, "Id": "1014x000007AbldAAC", "Name": "MappingDocColumnSection", "Value": "Migration Analysis", "Language": "en_US" }, { "attributes": { "type": "ExternalString", "url": "/services/data/v50.0/tooling/sobjects/ExternalString/1014x000007Abl4AAC" }, "Id": "1014x000007Abl4AAC", "Name": "MappingDocColumnType", "Value": "Intro", "Language": "en_US" }, { "attributes": { "type": "ExternalString", "url": "/services/data/v50.0/tooling/sobjects/ExternalString/1014x000007AblTAAS" }, "Id": "1014x000007AblTAAS", "Name": "MappingDocColumnSourceObject", "Value": "Upgrade Recommendation", "Language": "en_US" }, { "attributes": { "type": "ExternalString", "url": "/services/data/v50.0/tooling/sobjects/ExternalString/1014x00000FAMcRAAX" }, "Id": "1014x00000FAMcRAAX", "Name": "MappingDocColumnDestObject", "Value": "What industry product would you like to transition to?", "Language": "en_US" }, { "attributes": { "type": "ExternalString", "url": "/services/data/v50.0/tooling/sobjects/ExternalString/1014x00000FAMcWAAX" }, "Id": "1014x00000FAMcWAAX", "Name": "MappingDocColumnSource", "Value": "How is your customer represented?", "Language": "en_US" }, { "attributes": { "type": "ExternalString", "url": "/services/data/v50.0/tooling/sobjects/ExternalString/1014x00000FAMcbAAH" }, "Id": "1014x00000FAMcbAAH", "Name": "MappingDocColumnDest", "Value": "Do you group together your customers through any shared relationships?", "Language": "en_US" }, { "attributes": { "type": "ExternalString", "url": "/services/data/v50.0/tooling/sobjects/ExternalString/1014x00000FAMcgAAH" }, "Id": "1014x00000FAMcgAAH", "Name": "MappingDocSectionAdditional", "Value": "Do these groups aggregate or summarize counts/sums of customer related products,services, or activities?", "Language": "en_US" }, { "attributes": { "type": "ExternalString", "url": "/services/data/v50.0/tooling/sobjects/ExternalString/1014x00000FAGK9AAP" }, "Id": "1014x00000FAGK9AAP", "Name": "MappingDocTypeField", "Value": "Here\'s a high-level view of how FSC features and customizations can be approached for possible migration . Use this information to create the first draft of your gap analysis. To get a closer look, click the link for each feature or customization for recommendations for specific changes. But remember: You\'re the Salesforce expert at your company. Leverage the usage data in each section to decide whether our recommendations are worth your effort. For example, if the report identifies AppExchange packages require a thoughtful rollout but no one is using them, cross that feature off your gap analysis.", "Language": "en_US" }, { "attributes": { "type": "ExternalString", "url": "/services/data/v50.0/tooling/sobjects/ExternalString/1014x00000FAGK9AAP" }, "Id": "1014x00000FAGK9AAP", "Name": "MappingDocTypeRT", "Value": "Here\'s a high-level view of how FSC features and customizations can be approached for possible migration . Use this information to create the first draft of your gap analysis. To get a closer look, click the link for each feature or customization for recommendations for specific changes. But remember: You\'re the Salesforce expert at your company. Leverage the usage data in each section to decide whether our recommendations are worth your effort. For example, if the report identifies AppExchange packages require a thoughtful rollout but no one is using them, cross that feature off your gap analysis.", "Language": "en_US" }, { "attributes": { "type": "ExternalString", "url": "/services/data/v50.0/tooling/sobjects/ExternalString/1014x00000FAGK9AAP" }, "Id": "1014x00000FAGK9AAP", "Name": "MappingDocColumnDataType", "Value": "Data Type", "Language": "en_US" }, { "attributes": { "type": "ExternalString", "url": "/services/data/v50.0/tooling/sobjects/ExternalString/1014x00000FAGK9AAP" }, "Id": "1014x00000FAGK9AAP", "Name": "MappingDocColumnDecimalPlaces", "Value": "Decimal Places", "Language": "en_US" }, { "attributes": { "type": "ExternalString", "url": "/services/data/v50.0/tooling/sobjects/ExternalString/1014x00000FAGK9AAP" }, "Id": "1014x00000FAGK9AAP", "Name": "MappingDocColumnConflict", "Value": "Conflict for Transition?", "Language": "en_US" }, { "attributes": { "type": "ExternalString", "url": "/services/data/v50.0/tooling/sobjects/ExternalString/1014x00000FAGK9AAP" }, "Id": "1014x00000FAGK9AAP", "Name": "MappingDocColumnRequired", "Value": "Required?", "Language": "en_US" }, { "attributes": { "type": "ExternalString", "url": "/services/data/v50.0/tooling/sobjects/ExternalString/1014x00000FAGK9AAP" }, "Id": "1014x00000FAGK9AAP", "Name": "MappingDocColumnLength", "Value": "Length", "Language": "en_US" }, { "attributes": { "type": "ExternalString", "url": "/services/data/v50.0/tooling/sobjects/ExternalString/1014x00000FAGK9AAP" }, "Id": "1014x00000FAGK9AAP", "Name": "MappingDocColumnLookupFilters", "Value": "Length", "Language": "en_US" } ] }';
    private static final String MAPPING_JSON = '{ "recommended": [ { "mappingData": [ { "destination": "Account", "fieldMapping": [], "recordTypeMapping": [ { "userGenerated": "true", "destination": "PersonAccount", "source": "" } ], "showDetails": false, "source": "" }, { "destination": "Account", "fieldMapping": [], "recordTypeMapping": [], "showDetails": false, "source": "" }, { "destination": "Contact", "fieldMapping": [], "recordTypeMapping": [], "showDetails": false, "source": "" }, { "destination": "HealthcareProvider", "fieldMapping": [], "recordTypeMapping": [], "showDetails": false, "source": "" } ], "screenId": "m0K5f000000lvvdEAA", "sectionName": "Account Types - Provider" }, { "mappingData": [ { "destination": "CareProgram", "fieldMapping": [], "recordTypeMapping": [], "showDetails": false, "source": "" } ], "screenId": "m0K5f000000lvvsEAA", "sectionName": "Care Program - Care Program" } ], "additional": [] }';
    private static final String SECTION_NAME = 'Q2_Provider';

    private static final String RES_ANSWER = '[[{"Id":"m0a5f000000hPWQAA2","DeveloperName":"Q2_Provider","'+Utilities.namespaceUnderscore+'Question_Label__c":"AnswerProvider","'+Utilities.namespaceUnderscore+'Question__r":{"attributes":{"type":"SFDC_Industry_Assessment_Question__mdt","url":"/services/data/v52.0/sobjects/SFDC_Industry_Assessment_Question__mdt/m0e5f000000l8kYAAQ"},"'+Utilities.namespaceUnderscore+'Question_Group__r":{"attributes":{"type":"SFDC_Industry_Assessment_Question_Group__mdt","url":"/services/data/v52.0/sobjects/SFDC_Industry_Assessment_Question_Group__mdt/m0d5f000000dGaVAAU"},"MasterLabel":"Account Types"}}}]]';

    @TestSetup
    static void makeData(){
        Assessment__c setupAssessment = new Assessment__c(Selected_Products__c = 'AC OEMs;AC Dealers;AC Fleet Owners;AC Captive Finance Companies');
        insert setupAssessment;

        FileUtility.writeFileData(setupAssessment.Id, MappingService.FILENAME_MAPPINGJSON,  MappingService.FILEEXTENSION_MAPPINGJSON, MAPPING_JSON);
    }

    @IsTest
    static void checkSection(){
        Test.setMock(HttpCalloutMock.class, MockCalloutDefinitions.createMockWithResponseList(new List<String>{ RES_ANSWER, EXTERNAL_STRINGS }));
        Assessment__c assessment = [Select Id From Assessment__c Limit 1];
        
        Test.startTest();
        Boolean found = HealthCloudSelectionHelper.checkSectionName(assessment.Id, SECTION_NAME);
        Test.stopTest();
        System.assert(found==false);
    }
}